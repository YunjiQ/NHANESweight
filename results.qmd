# Results

## Longitudinal BMI Changes

In order to further know the weight health of the sample, we firstly use the BMI formula given by the CDC to calculate each person's current and previous BMI.

-   **Formula: weight (lb) / \[height (in)\]^2^ x 703**

```{r warning=FALSE, message=FALSE}
# get the bmi
whq <- read.csv("data/whq_handle_missing.csv")

whq$prev_bmi <- round((whq$previous_weight / (whq$current_height^2)) * 703, 2)
whq$curr_bmi <- round((whq$current_weight / (whq$current_height^2)) * 703, 2)

classify_bmi <- function(bmi) {
  if (bmi < 18.5) {
    return('Underweight')
  } else if (bmi >= 18.5 & bmi <= 24.99) {
    return('Healthy Weight')
  } else if (bmi >= 25 & bmi <= 29.99) {
    return('Overweight')
  } else {
    return('Obese')
  }
}

# classify the bmi level
whq$prev_bmi_level <- sapply(whq$prev_bmi, classify_bmi)
whq$curr_bmi_level <- sapply(whq$curr_bmi, classify_bmi)

whq$prev_bmi_level <- factor(whq$prev_bmi_level, 
                        levels = c('Underweight', 'Healthy Weight', 'Overweight', 'Obese'))
whq$curr_bmi_level <- factor(whq$curr_bmi_level, 
                        levels = c('Underweight', 'Healthy Weight', 'Overweight', 'Obese'))

whq$bmi_change <- as.numeric(whq$curr_bmi) - as.numeric(whq$prev_bmi)

whq$bmi_level_change <- ifelse(whq$bmi_change < 0, "lose",
                             ifelse(whq$bmi_change > 0, "gain", "maintain"))

whq$bmi_level_change <- factor(whq$bmi_level_change, 
                        levels = c('lose', 'maintain', 'gain'))

write.csv(whq, "data/whq.csv", row.names = FALSE)
```

```{r warning=FALSE, message=FALSE}
library(ggplot2)
library(dplyr)
# nrow(whq) # 4503

```

## 1. Hexgon Heatmap - BMI distribution by gender

```{r}
# nrow(whq[whq$current_weight > 600, ]) # 39
# nrow(whq[whq$current_height > 100, ]) # 48

whq <- whq |>
  filter(current_height < 100) |>
  filter(current_weight < 600)

ggplot(whq, aes(current_height, current_weight)) +
  geom_point(alpha = 0.3) +
  geom_density_2d() +
  labs(title = "Scatterplot with Density Contour Lines",
       x = "Current Height",
       y = "Current Weight")
```

## 2. Pyramid chart - Age distribution by gender

```{r warning=FALSE, message=FALSE}
# min(whq$age_heaviest_weight) # 12
# max(whq$age_heaviest_weight) # 99999
# nrow(whq[whq$age_heaviest_weight > 80, ]) # 21  

whq <- whq |>
  filter(age_heaviest_weight < 100)

whq$age_group <- cut(whq$age_heaviest_weight,
                     breaks = c(10, 20, 30, 40, 50, 60, 70, 80),
                     labels = c("11-20", "21-30", "31-40", "41-50", "51-60", "61-70", "71-80"),
                     include.lowest = TRUE)

plot_data <- whq %>%
  group_by(age_group, gender) %>%
  summarise(count = n()) %>%
  ungroup()

plot_data$count[plot_data$gender == "female"] <- -plot_data$count[plot_data$gender == "female"]

ggplot(plot_data, aes(x = count, y = age_group, fill = gender)) +
  geom_bar(stat = "identity", position = "identity", color = "black", alpha = 0.7) +
  geom_text(aes(label = abs(count), hjust = ifelse(count < 0, 1.1, -0.1)), color = "black", size = 3) +
  labs(title = "Age Distribution by Gender",
       x = "Position",
       y = "Count") +
  scale_x_continuous(labels = abs) + 
  theme_minimal()
```

## Correlation Analysis Between Factors and BMI Change

-   Dieting and BMI

    ```{r warning=FALSE, fig.width=12, fig.height=8}
    library(grid)
    library(vcd)
    library(RColorBrewer)

    # mosaic plot
    dieting_sub_df <- whq |>
      group_by(bmi_level_change, eat_less, skip_meal, low_cal) |>
      summarise(frequency = n(), .groups = 'drop') |>
      rename("Freq" = frequency)

    mosaic(bmi_level_change ~ eat_less + skip_meal + low_cal, dieting_sub_df , direction = c("v", "v", "h", "h"),
           highlighting_fill= rev(brewer.pal(3, "RdBu")),
           rot_labels = 0,
           margins = c(5, 10, 10, 10),
           main = "Mosaic plot for Dieting and BMI")

    ```

```{=html}
<!-- -->
```
-   Dietary Preferences

    ```{r warning=FALSE, fig.width=10}
    library(ggalluvial)

    preference_sub_df <- whq |>
      group_by(bmi_level_change, more_vege, less_sugar, fewer_carb, less_fat) |>
      summarise(frequency = n(), .groups = 'drop') |>
      rename("Freq" = frequency)

    ggplot(preference_sub_df, aes(y = Freq, axis1 = more_vege, axis2 = less_sugar, axis3 = fewer_carb, axis4 = less_fat)) +
      geom_alluvium(aes(fill = bmi_level_change), width = 1/12) +
      geom_stratum(width = 1/12) +
      geom_label(stat = "stratum", aes(label = after_stat(stratum))) +
      scale_x_discrete(expand = c(0.05, 0.05)) +
      scale_fill_brewer(type = "qual", palette = "RdBu", direction = -1) +
      labs(title = "Alluvium Plot for Dietary Preferences and BMI Change") +
      annotate("text", x = 1, y = 0, label = "More Vegetables", vjust = 1.5, hjust = 0.5) +
      annotate("text", x = 2, y = 0, label = "Less Sugar", vjust = 1.5, hjust = 0.5) +
      annotate("text", x = 3, y = 0, label = "Fewer Carbs", vjust = 1.5, hjust = 0.5) +
      annotate("text", x = 4, y = 0, label = "Less Fat", vjust = 1.5, hjust = 0.5) +
      theme(axis.title.x = element_blank()) 
    ```
